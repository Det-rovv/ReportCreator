<h1 align="center">Ситсема формирования отчетов <b>WReport</b></h1>
<h3>Здеcь будут содержать все файлы для командного проекта по формирования отчетов компании между заказчиками</h3>

# Начало работы
## Клонирование репозитория
1. Выполните клонирование репозитория через команду в нужную директорию:
```
git clone https://github.com/EmAksS/ReportCreator.git
```
2. Создадите и запустите виртуальную среду в директории `reportcreator`:
```
python -m venv venv
.\venv\Scripts\activate
```
3. Установите все зависимости через `requirements.txt`
```
pip install -r ../requirements.txt
```
4. Создадите и заполните `.env`-файл. Структура переменных описана в файле `.env.dist`
    - Значение `MODE` ставить на любое значение, кроме случаев загрузки сайта на продакшн - тут нужно ставить значение `production`.
    - Значение `SECRET_KEY` можно оставить пустым (при запуске будет подгружаться публичный ключ), однако при загрузке на продакшн тут должен быть СЕКРЕТНЫЙ ключ проекта.
4. Создайте новую ветку Git'a для работы.

## Миграции
Приложение содержит *миграции* - это специальные файлы для организации структуры базы данных.
По умолчанию, миграции уже приготовлены и они располагаются в `backend/migrations/`.
Перед первым запуском приложения, примените эти миграции для организации полей базы данных:
```
py .\manage.py migrate
```
После этого, будут организован файл базы данных в `core/db.sqlite3`.

*Примечание:* Если мы изменяете структуру базы данных (т.е. меняете файлы в папке `<app_name>/models/<model_name>`), вам нужно создать миграции командой: 
```
py .\manage.py makemigrations
```
...и далее применить миграции командой `migrate`.

## Запуск приложения
1. Введите команду:
```
python manage.py runserver
```
2. Перейдите по ссылке http://127.0.0.1:8000/ в браузере.

---

# Документация по работе
## Глосарий
- Исполнитель - компания, которая зарегистрирована как исполнитель услуг. 
- Заказчик - внешняя компания, которая зарегистрирована как заказчик услуг исполнителя.
- Модель - таблица баз данных, куда сохраняются данные
## Компании 
Объявление моделей компаний указано в файле `/backend/models/company.py`
### Абстрактная модель компании
Это базовая модель, где будут находиться общие поля для каждой компании (Исполнителя и Заказчика):
- ID (ключевое поле, автоинкрементирующий номер)
- Название компании (с сокращением и абревиатурами: ООО "Трайв Технолоджис")
- Полное название компании (с расшифровкой абревиатур: общество с ограниченной ответственностью «Трайв Технолоджис»)
- Название должности (директор или ген.директор)
- ФИО директора (полностью - Иванов Иван Иванович)

**ID** - это автоинкрементирующее поле, действие которое переходит в качестве Django и является ключевым полем для элемента. Тип данных - число.

**Название компании** (`company_name`) - обязательное поле. Принимает название компании с сокращениями и абревиатурами. Максимальная длина поля - 64 символа. Принимает только текстовые символы.

**Полное название компании** (`company_fullName`) - текстовое поле, которое содержит полное название компании с расшифровкой всех абревиатур. Максимальная длина 256 символов. Не может быть пустым. Если при создании элемента значение не задано, то принимает значение поля `company_name`.

**Название должности руководителя** (`director_post`) - именование должности руководителя, от чьего имени будут подписываться все документы от компании. Максимальная длина - 32 символа. Не может быть пустым. По умолчанию или если поле не было заполнено, принимает значение "Директор"

**ФИО руководителя** (`director_name`) - ФИО руководителя полностью, от чьего имени будут подписываться документы. Не может быть пустым. Максимальная длина - 64 символа.

**Инициалы руководителя** (`director_shortName`) - инициалы руководителя компании. Максимальная длина строки - 32 символа. Не может быть пустым. 
	В дальнейшем оно будет автоматически создаваться из значений поля `director_name`.

### Исполнитель
Модель наследует все поля из абстрактной модели компании.
> *Имеются ли дополнительные поля у исполнителя?*

### Заказчик
Модель компании-заказчика, который выполняет заказ у компании-исполнителя. Наследует все поля из абстрактной модели компании, а также добавляются дополнительные поля:

**Город-месторасположение компании** (`contractor_city`) - название города, где располагается компания-заказчик. Представляет собой строку, максимальная длина равна 64 символа. Не может быть пустым.

## Пользователь системы
Модель пользователя системы, который выполняет работу с системой.
Каждый пользователь связан с конкретной компанией-исполнителем.
Пользователь может быть связан только с одной конкретной компанией.

Здесь представлена только информация с пользователем, как объектом системы.

Поля пользователя:
- username - имя пользователя в системе.
- last_name - фамилия пользователя.
- first_name - имя пользователя.
- patronymic - отчество пользователя.
- related_company - компания, которой принадлежит пользователь. Является полем таблицы `companies.Executor`.

## API
Все действия с сервером будет происходить через API.
Абсолютно вся работа API описана в директории `api/`.
Для работы используется модуль `django-rest-framework`.

### Принцип взаимодействия
Пока проект не загружен на продакшн, API будет доступно по адресу локалхоста с портом `8000`.

**ВАЖНО!** Проект принимает только запроса от локалхоста с портом `3000` - React-проекта.
Перед запуском проекта убедитесь, что фронтенд будет запускаться именно на этом порту!

Принцип работы действует согласно правилам API, предоставляя заголовки, коды ответов и само тело ответа.

### Точки взаимодействия
Все точки взаимодействия API описаны относительно адреса `https://127.0.0.1:8000`

- `/csrf/` - получить CSRF-токен текущей сессии - указан по ключу `csrf_token`
- `/check_auth/` - проверить, является ли текущий пользовать авторизирован в системе.
Статус аутентификации указан по ключу `status`: `authenticated`|`not_authenticated`.
При аутентификации пользователя, также возвращает в ключе `user` информацию о пользователе.
- `/login/` - POST-метод, аутентификация пользователя в системе. Обязан принять request-запрос в формате ключ-значение в формате ниже. При успехе возвращает ключ `"status": "success"` и информацию о пользователе в поле `user`. При неудаче, возвращает ошибку `400`.
```json
{
    "username": "логин_пользователя",
    "password": "пароль_пользователя"
}
```
- `/logout` - POST-метод, только для авторизированных пользователей. 
Выполняет выход пользователя из системы. 
При успехе возвращает поле `"status": "success"`. 
Если пользователь не авторизирован, возвращает ошибку `403`.
- `register/company/` - POST-метод. 
Осуществляет регистрацию компании и его суперпользователя. Обязан модержать поля, указанные ниже. 
При успехе, возвращает код `201`, а также поля `"status": "success"`, информацию о сохранённой компании (`company`) и информацию о суперпользователе этой компании (`user`). 
При ошибке возвращает код `403`.
```json
{
    "conpany_name": "краткое название компании",
    "company_fullName": "полное название компании",
    "username": "логин создаваемого суперпользователя",
    "password": "пароль создаваемого суперпользователя"
}
```
- `/register/superuser/` - POST-метод, только для авторизированного суперпользователя компании. 
Создаёт пользователя данной компании.
Обязан содержать поля, указанные ниже.
При успехе создания пользователя, возвращает код `201`, `"status": "success"` и информацию о созданном пользователе `user`.
- `/company/` - только для авторизированных пользователей.
Берёт компанию пользователя и информацию о компании `company`, а также информацию о всех пользователях-участниках этой компании `users`.
Если пользователь не состоит в компании, возвращает код `400`.

*Все другие вопросы спрашивайте на странице проекта в Трекере.*